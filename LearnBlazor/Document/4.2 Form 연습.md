# Form 연습 

ASP.NET 서버로 폼 내용을 전달하여 처리. 

- json 파일 저장과 로딩. 

ASP.NET에 대한 연습이다. 

## Swagger Nuget 설치 

- [VS Swagger 설명](https://learn.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle?view=aspnetcore-7.0&tabs=visual-studio)
  - swashbuckle에 대한 사용 설명이다. 


Swashbuckle.AspNetCore가 Swagger, SwaggerGen, SwaggerUI를 모두 포함하고 있다. 

- Microsoft.Extensions.ApiDescription.Server 
- Microsoft.OpenApi 

위 두 개 Nuget에 의존한다. 

Swagger 설명이 잘 나온다. 

Controller를 추가하는 건 매우 단순하다. 모델에 맞춰 추가하고 
함수를 구현하면 된다. 요청에 대해 모두 Controller로 만들어야 한다. 

PostMan 앱을 받아서 설치하고 테스트 한다. 잘 된다. 

매우 편하고 쉽게 된다. 

## Blazor에서 호출하기 

- [Blazor의 Rest 요청](https://learn.microsoft.com/ko-kr/aspnet/core/blazor/call-web-api?view=aspnetcore-7.0&pivots=server)

Microsoft.Extensions.Http에 AddHttpClient() Extension 함수가 있다. 
꽤 많은 Dependency를 갖는다. 인터넷 망에서 받은 후에 하나씩 찾아서 넣는다. 

```c#
private static async Task PostJsonContent(string uri, HttpClient httpClient)
{
    var postUser = new User { Name = "Steve Gordon" };

    var postRequest = new HttpRequestMessage(HttpMethod.Post, uri)
    {
        Content = JsonContent.Create(postUser)
    };

    var postResponse = await httpClient.SendAsync(postRequest);

    postResponse.EnsureSuccessStatusCode();
}
```

JsonContent.Create()로 Json Content를 생성 가능하다. 

		text	'{"servers":[{"address":"127.0.0.1:7000"},{"address":"127.0.0.1:8000"}]}'	string

위의 텍스트를 잘 받았는데 DeserialzieAsync<ServerList>로 deserialize가 안 된다. 

https://github.com/dotnet/aspnetcore/issues/42545
- 이상하게 안 된다. JSON은 정확하게 오는데 Deserialize에서 실패. null만 돌아온다. 

매우 웃긴 상황. ASP.NET 서버에서 돌려준 JSON을 Newtonsoft.Json으로는 잘 되고 System.Text.Json으로는 안 된다.

여러 옵션으로 해보았지만 안 되어서 일단 Newtonsoft.Json으로 진행 

## 요청 보내고 받기 

```c#
protected override async Task OnInitializedAsync()
{
    await base.OnInitializedAsync();

    var reqServer = new ServerList.Server() { Address = "127.0.0.1:9000" };

    var json = JsonConvert.SerializeObject(reqServer);
    var content = new System.Net.Http.StringContent(json, System.Text.Encoding.UTF8, "application/json");
    var request = new HttpRequestMessage
        {
            Method = HttpMethod.Post,
            RequestUri = new Uri("https://localhost:7087/ServerConfig"),
            Content = content
        };

    var response = await Client.SendAsync(request);

    if (response.IsSuccessStatusCode)
    {
        using var responseStream = await response.Content.ReadAsStreamAsync();

        StreamReader reader = new StreamReader(responseStream);
        respText = reader.ReadToEnd();

        // 매우 웃긴 상황. ASP.NET 서버에서 돌려준 JSON을 Newtonsoft.Json으로는 잘 되고 System.Text.Json으로는 안 된다.
        serverList = JsonConvert.DeserializeObject<ServerList>(respText);
    }
    else
    {
        // Show Alert Dialog
    }
}
```

위의 예시로 대부분의 사용성을 만족하는 흐름을 만들었다. 

## 에러 처리 

https://learn.microsoft.com/en-us/aspnet/core/blazor/fundamentals/handle-errors?view=aspnetcore-7.0

예외가 나오거나 할 경우 처리가 필요하다. 
데이터가 null인 경우에 대한 처리가 필요하다. 

이제 경험이 쌓이면 충분히 여러 가지를 해나갈 수 있겠다. 

## 입력 받아서 파일에 쓰기 

Radzen의 폼 기능으로 입력을 받아서 요청하고 파일에 쓴다. 



